\documentclass[a4paper,uplatex]{jsarticle}


% 数式
\usepackage{amsmath,amsfonts}
\usepackage{bm}
% 画像
\usepackage[dvipdfmx]{graphicx}
\usepackage{tikz}
\usepackage{gnuplot-lua-tikz}
% フォント
\usepackage[deluxe]{otf}

\usepackage{booktabs}

\numberwithin{equation}{section}
\numberwithin{figure}{section}
\numberwithin{table}{section}

\begin{document}

\title{PRML Chapter 1}
\author{}
\date{}
\maketitle

\section{例：多項式曲線フィッティング}
実数値の入力変数\(x\)を観測し、それを用いて実数値の目標変数\(t\)を予測する回帰問題を考える。ただし、ここでは関数\(\sin(2\pi x)\)にガウス分布に従う
ランダムノイズを加えて生成した人工データを用いる。

訓練集合として、\(N\)個の観測地\(x\)を並べた\(\bm{x} \equiv (x_1,\cdots,x_N)^T\)と、それぞれに対応する観測値\(t\)を並べた\(\bm{t} \equiv (t_1,\cdots,t_N)^T\)が与えられたとする。
図\ref{fig:toy data}は、\(N=10\)の場合の人工データの例である。

我々の目標は、この訓練集合を利用して、新たな入力変数\(\hat{x}\)に対して目標変数\(\hat{t}\)の値を予測することである。

\begin{figure}[htbp]
  \centering
  \input{fig/toy_data.tex}
  \caption{\(N=10\)個の訓練データの例}
  \label{fig:toy data}
\end{figure}

ここでは、以下のような多項式を用いてデータへのフィッティングを行うことにする。
\begin{equation}
  y(x,\bm{w}) = w_0 + w_1 x + w_2 x^2 + \cdots + w_M x^M = \sum_{j=0}^{M} w_j x^j
\end{equation}
ただし、\(M\)は多項式の\textbf{次数(order)}で、\(x^j\)は\(x\)の\(j\)乗を表す。多項式の係数\(w_0,\cdots,w_M\)をまとめて\(\bm{w}\)と書くことにする。
多項式\(y(x,\bm{w})\)は、\(x\)の非線形関数であるが、係数\(\bm{w}\)の線形関数であることに注意する。このような、未知パラメータに対して線形な関数は\textbf{線形モデル}と呼ばれる。

訓練データに多項式をあてはめることで係数の値を求める。これは、\(\bm{w}\)を任意に固定したときの関数\(y(x,\bm{w})\)と
訓練集合のデータ点との間のずれを測る\textbf{誤差関数(error function)}の最小化で達成できる。ここでは、誤差関数として単純で広く用いられている\textbf{二乗和誤差(sum-of-squares error)}を用いる。
式で書けば、
\begin{equation}
  E(\bm{w}) = \frac{1}{2} \sum_{n=1}^{N} \{y(x_n,\bm{w}) - t_n\}^2
  \label{eq:sum of squares error}
\end{equation}
となる。ただし、後で便利なように係数\(1/2\)をかけている。

このように、\(E(\bm{w})\)をできるだけ小さくするような\(\bm{w}\)を選ぶことで曲線当てはめ問題を解くことができる。では、誤差関数を最小にする解\(\bm{w^*}=\{w_i\}\)を求める。
誤差関数を最小にする解をもとめるには、\(E(\bm{w})\)を\(w_i\)について微分し、その微分がゼロになるような\(w_i\)を求めればよい。
つまり、
\begin{equation}
  \frac{\delta E}{\delta w_i} = 0
\end{equation}
を求める。
はじめに、\(E(\bm{w})\)を\(w_i\)について微分する。
\begin{align*}
  \frac{\delta E}{\delta w_i} &= \frac{1}{2}\sum_{n=1}^{N}\left\{2\left(\sum_{j=0}^{M}w_j x_n^j-t_n\right)-x_n^i\right\} \\
                              &= \sum_{n=1}^{N}\left(x_n^i\sum_{j=0}^{M}w_j x_n^j\right) - \sum_{n=1}^{N}t_n x_n^i \\
\end{align*}
ここで、\(\frac{\delta E}{\delta w_i} = 0\)を求めるので、
\begin{equation}
  \sum_{n=1}^{N}\left(x_n^i\sum_{j=0}^{M}w_j x_n^j\right) = \sum_{n=1}^{N}t_n x_n^i
\end{equation}

左辺を変形すると、
\begin{align*}
  (左辺) &= \sum_{n=1}^{N}\left\{x_n^i\left(w_0 x_n^0+w_1x_n^1+\cdots+w_Mx_n^M\right)\right\} \\
         &= \sum_{n=1}^{N}\left\{w_0x_n^{i+0}+w_1x_n^{i+1}+\cdots+w_Mx_n^{i+M}\right\} \\
         &= \sum_{n=1}^{N}\sum_{j=0}^{M}\left(w_jx_n^{i+j}\right) \\
         &= \sum_{j=0}^{M}\left\{\sum_{n=1}^{N}(x_n)^{i+j}\right\}w_j \\
\end{align*}
また、
\begin{equation}
  A_{ij} = \sum_{n=1}^{N}(x_n)^{i+j}, T_i = \sum_{n=1}^{N}t_n(x_n)^i
\end{equation}
とおくと、
\begin{equation}
  \sum_{j=0}^{M}A_{ij}w_j = T_i
\end{equation}
となる。これは線形方程式であり、これを解くことで、誤差関数を最小にする解\(\bm{w^*}\)を求めることができる。

多項式の次数\(M\)を選ぶのは、\textbf{モデル比較(model comparison)}あるいは\textbf{モデル選択(model selection)}と呼ばれる問題である。例として
図\ref{fig:various M}に、\(M=0,1,3,9\)の場合のフィッティング結果を示す。

\begin{figure}[htbp]
  \centering
  \input{fig/poly_fit.tex}
  \caption{いろいろな次数\(M\)のプロット}
  \label{fig:various M}
\end{figure}

3次の場合が\(\sin (2\pi x)\)に最もよく当てはまっている。次数をもっと高い\(M=9\)にすると、訓練データにはよく当てはまっているが、
\(\sin (2\pi x)\)の表現としては明らかに不適切である。このような振る舞いは\textbf{過学習(過適合;over-fitting)}として知られている。

汎化性能が\(M\)にどう依存するかを定量的に評価するために、100個のデータ点からなる独立したテスト集合を、訓練集合と同じやり方で生成する。
すると、選んだ\(M\)の各値に対して、訓練データに対して\ref{eq:sum of squares error}で与えられる\(E(\bm{w^*})\)が計算できるが、
テスト集合に対しても同じように\(E(\bm{w^*})\)を計算することができる。このとき、
\begin{equation}
  E_{\text{RMS}} = \sqrt{2E(\bm{w^*})/N}
\end{equation}
で定義される\textbf{平均二乗平方根誤差(root-mean-square error, RMS error)}を用いると便利なことがある。
\(N\)で割ることによってサイズの異なるデータ集合を比較することができ、平方根をとることによって、\(E_{\text{RMS}}\)は目的変数\(t\)と同じ尺度であることが保証される。
いろいろな\(M\)に対する訓練集合とテスト集合のRMS誤差のグラフを図\ref{fig:RMS error}に示す。
図\ref{fig:RMS error}を見てわかるように、\(M\)が小さいと、\(\sin (2\pi x)\)の振動を捉えることができないため、訓練集合とテスト集合のRMS誤差が大きくなる。また、\(M\)が大きいと、
訓練集合に対してはよく当てはまるが、テスト集合に対しては当てはまらなくなる。
\begin{figure}[htbp]
  \centering
  \input{fig/RMS_error.tex}
  \caption{訓練集合とテスト集合のRMS誤差}
  \label{fig:RMS error}
\end{figure}
\end{document}